A <- read.table (".//input.parameters.txt", sep="\t", header=T)
B1 <- A[grepl('canonical', A[,1]),]
B2 <- A[grepl('iORF', A[,1]),]
B3 <- A[A$PME < 0.1,]
C1 <- data.frame(cbind(B1, gr=rep(1, nrow(B1))))
C2 <- data.frame(cbind(B2, gr=rep(0, nrow(B2))))
C3 <- data.frame(cbind(B3, gr=rep(0, nrow(B3))))
T1 <- rbind(C1[sample(nrow(C1), min(nrow(C1)/3, 1000)),], C2[sample(nrow(C2), min(nrow(C2)/3, 3000)),], C3[sample(nrow(C3), min(nrow(C3)/3, 500)),])
T2 <- rbind(C1[sample(nrow(C1), min(nrow(C1)/3, 1000)),], C2[sample(nrow(C2), min(nrow(C2)/3, 3000)),], C3[sample(nrow(C3), min(nrow(C3)/3, 500)),])
pred <- glm(gr~f1+PME+f1max, data=T1)
write.table (summary(pred)$coefficients, ".//model.parameters.txt", sep="	", quote=F)
save(pred, file = ".//model.rda")
E1 <- predict(pred, T2)
E2 <- cbind(E1, T2$gr)
a <- seq(-0.5,1.5,0.005)
fpr <- array()
tpr <- array()
out <- matrix(NA, nrow=length(a), ncol=7)
for (i in 1:length(a)) {
tp <- sum(E2[,1] > a[i] & E2[,2]>0)
fp <- sum(E2[,1] > a[i] & E2[,2]==0)
tn <- sum(E2[,1] <= a[i] & E2[,2]==0)
fn <- sum(E2[,1] <= a[i] & E2[,2]>0)
fpr[i] <- fp/(fp+tn)
tpr[i] <- tp/(tp+fn)
out[i,] <- c(a[i], tp, fp, tn, fn, fpr[i], tpr[i])
}
pdf (file=".//plot.ROC.curve.pdf")
plot(fpr, tpr, col=0, main="ROC Curve", xlab="False positive rate", ylab="True positive rate")
lines(fpr, tpr,col=2, lwd=3)
dev.off()
colnames(out) <- c("cutoff", "True.pos", "False.pos", "True.neg", "False.neg", "False.pos.rate", "True.pos.rate")
write.table (out, ".//stat.cutoff.txt", sep="\t", quote=F, row.names=F)
pred.pvalue <- sprintf("%.4f", predict(pred, A))
out2 <- data.frame(cbind(A, pred.pvalue))
write.table (out2, ".//pred.pvalue.parameters.txt", sep="\t", quote=F, row.names=F)
